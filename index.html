<script>
var JSMathExt = {};

JSMathExt.matrix = function(){
	var rowSize = arguments[0]
		,colSize = arguments[1]
		,data = arguments[2]
		,_size = arguments.length;
	//creates matrix 
	if( _size == 0 ){
		this.rowSize = rowSize || 3;
		this.colSize = colSize || 3;
		this.data = [[9,1,2],[3,4,5],[6,7,8]] || data;
		
	}else if( _size == 1 ){
		if( !rowSize.length ){
			this.rowSize = this.colSize = rowSize;
			this.data = [];
			var row = [];
			for(var i = 0; i < rowSize; i++ ){
				for(var j = 0; j < rowSize; j++ ){
					row[j] = parseInt(rowSize*Math.random());	
				}
				this.data[i] = row;
				row = [];
			}
		}else{
			var matr = rowSize
				,rows = matr.length
				,cols = (function(){
					var max_col = matr[0].length;
					for(var i = 0; i<matr.length; i++){
						if(max_col < matr[i].length)max_col = matr[i].length;
					}
					return max_col;
				})(matr)
				,row = [];
				
			this.data = [];
			this.rowSize = rows;
			this.colSize = cols;	
			
			for(var i=0; i < rows; i++){
				for(var j=0; j < cols; j++){
					row[j] = (matr[i][j] || 0);
				}
				this.data[i] = row;
				row = [];
			}
		}
		
	}else if( _size == 2 ){
		this.rowSize = rowSize;
		this.colSize = colSize;
		this.data = [];
		var row = [];
		for(var i = 0; i < rowSize; i++ ){
			for(var j = 0; j < colSize; j++ ){
				row[j] = parseInt(rowSize*colSize*Math.random());	
			}
			this.data[i] = row;
			row = [];
		}
	
	}else{
		this.rowSize = rowSize ;
		this.colSize = colSize ;
		this.data = []; //data;
		
		var count = (data.join().split(",")).length
			,mustBe = rowSize*colSize;
		
		if(count < mustBe){
			throw("There are too little elements ");
		}else if(count > mustBe){
			throw("There are too more elements ");
		}else{
			var row = [];
			console.log(data);
				
			for(var i = 0; i < rowSize; i++ ){
				for(var j = 0; j < colSize; j++ ){
					row[j] = parseInt( data.shift() );	
				}
			this.data[i] = row;
			row = [];
			}
		}
	}
	
	//print matrix to web console and return matrix as string
	this.print = function(){
		var me = this , str = "";
		if(me.data.length == 0)return null;
		for(var i=0;i<me.rowSize;i++){
			for(var j=0;j<me.colSize;j++)
				str += me.data[i][j]+" ";
			str += "\n";
		}
		console.log(str);
		//return str;
	};
	
	//gets i-th row as array
	this.getRowAt = function(k){
		var ar = [];
		for(var i = 0; i < this.colSize; i++){
			ar[i] = this.data[k][i];
		}
		return ar;
	};
	
	//change N-th row 
	this.replaceRowAt = function(row,k){
		for( var i = 0; i < this.colSize; i++ ){
			this.data[k][i] = row[i];
		}
	}  
	
	//gets i-th column as array
	this.getColAt = function(k){
		var ar = [];
		for( var i = 0; i < this.rowSize; i++ ){
			ar[i] = this.data[i][k];
		}
		return ar;
	};
	
	//replace i-th column 
	this.replaceColAt = function(col,k){
		for( var i = 0; i < this.rowSize; i++ ){
			this.data[i][k] = col[i];
		}
	};
	
	//scalar value of two vectors
	this.scalar = function(m1,m2){
		var val = 0;
		for(var i = 0; i < m1.length; i++)val +=(m1[i]*m2[i]);
		return val;
	};
	
	//check matrix to be N x N
	this.isQuad = function(){
		if(this.colSize == this.rowSize)return true;
		return false;
	};
	
	//inner function return multiplication of dimensions of matrix N*M
	//it is used (after) in conjunction with isQuad
	this._prodSize = function(){
		return this.colSize * this.rowSize;
	};
	
	//multiply matrix to matrix or number, return resulting one
	this.multiply = function(){
		var matr = arguments[0]//ohter matrix
			,me = this//this matrix 
			,res = new matrix(me.colSize,me.colSize);

		if( (matr instanceof matrix) ){
			if( me.isQuad() && matr.isQuad() ){
				//if matrixes are quadratic then check them to be equal size
				if( me._prodSize() == matr._prodSize() ){
					for(var i = 0; i < me.rowSize; i++){
						for(var j = 0; j < me.colSize; j++){
							res.data[i][j] = me.scalar(me.getRowAt(i),matr.getColAt(j));
						}
					}
					
					return res;
				}else{
					throw("Matrixes have not equal size");
				}
			}else{
				throw("Matrix is not quadratic ");
			}
			
		}else{
			var number = parseInt(matr);
			for(var i = 0; i < me.rowSize; i++){
				for(var j = 0; j < me.colSize; j++){
					me.data[i][j] *= number;
				}
			}
		}
		return me;
	};
	
	//gets submatix 
	this.sub = function(){
		var data = []
			,matr = null
			,n = arguments[0];
		
		for(var i = 0; i < this.rowSize; i++){
			for( var j =0; j < this.colSize; j++){
				if(i != 0 && j!= 0) data.push(this.data[i][j]);
			}
		} 
		
		matr = new JSMathExt.matrix(this.rowSize-1,this.colSize-1,data);
		return matr;
	};
	
	//computes determinant of the matrix
	this.det = function(){
		var me = this
			,det = 0.0
			,del = 0
			,rows = me.rowSize
			,cols = me.colSize
			,lader = 0;
		
	};
};

M = JSMathExt.matrix ;
</script>
